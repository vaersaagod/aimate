const T=Garnish.Modal.extend({init:function(){this.base(),this.setSettings({resizable:!0});const e=$('<div class="modal fitted aimate-customprompt"></div>').addClass().appendTo(Garnish.$bod),r=$(`
                <div class="body" style="display:flex;flex-direction:column;min-height:100%;">
                    <div class="header" style="flex: none;">
                        <h1 style="margin-bottom:10px;">Custom prompt</h1>
                        <p class="notice has-icon">
                            <span class="icon" aria-hidden="true"></span>
                            <span>Add a &lt;text&gt; token to the prompt to include the current value in the field.</span>
                        </p>
                    </div>
                    <form method="post" accept-charset="UTF-8" style="display:flex;height:100%;flex: 1 1 auto;position:relative;">
                        <textarea style="width:420px;min-width:100%;max-width:100%;resize:none;padding:10px;"></textarea>
                    </form>
                </div>
            `).appendTo(e.empty()),p=$('<div class="footer"/>').appendTo(r),n=$('<div class="buttons right"/>').appendTo(p),a=$("<button/>",{type:"button",class:"btn",text:Craft.t("app","Cancel")}).appendTo(n),m=Craft.ui.createSubmitButton({label:Craft.t("app","Apply")}).appendTo(n);this.$textarea=r.find("textarea"),this.addListener(a,"click","onCancel"),this.addListener(m,"click","onApply"),this.$textarea=e.find("textarea"),this.setContainer(e)},onShow:function(){const e=this;this.promise=new Promise((r,p)=>{e.reject=p,e.resolve=r})},onHide:function(){this.$textarea.val("")},onCancel:function(){this.resolve(),this.hide()},onApply:function(){this.resolve(this.$textarea.val()),this.hide()},getText:function(){return this.promise}});$(()=>{let e;const r=async n=>{console.log("AIMate :: onPromptClick");const{currentTarget:a}=n,{field:m,element:h,site:u,layoutElement:s}=a.dataset,x=$("body").find('.field[data-layout-element="'+s+'"]');if(x.length===0){Craft.cp.displayError("Field not found");return}const{type:C}=x.get(0).dataset;let o;if(C==="craft\\fields\\Table"||(o=x.find(".input input,textarea").get(0)),!o){Craft.cp.displayError("Input not found");return}let i={};if(a.hasAttribute("data-custom")){e||(e=new T),e.show();const t=await e.getText();if(!t)return;i.custom=t}else{const{prompt:t}=a.dataset;if(!t){Craft.cp.displayError("No prompt");return}i.prompt=t}const f=$(o.closest("[data-element-editor]")).data("elementEditor");i={...i,elementId:h,siteId:u},f&&(i={...i,draftId:f.settings.draftId,isProvisionalDraft:f.settings.isProvisionalDraft}),Craft.sendActionRequest("POST","_aimate/default/do-prompt",{data:{text:o.value,...i}}).then(t=>{const{data:l}=t;if(!l.text)return;const g=o.closest(".field"),{type:y}=g.dataset;if(y==="craft\\ckeditor\\Field"){const d=g.querySelector(".ck-editor__editable"),c=d?d.ckeditorInstance:null;if(!c)throw new Error("Unable to find CKEditor instance in DOM");c.focus(),c.execute("selectAll");const v=c.data.processor.toView(l.text),b=c.data.toModel(v);c.model.insertContent(b)}else if(y==="craft\\redactor\\Field"){const d=$R(`#${o.id}`);d.editor.focus(),d.insertion.set(l.text),d.source.getElement().val(l.text)}else o.focus(),o.select(),document.execCommand("insertText",!1,l.text)||o.setRangeText(l.text);f&&f.checkForm()}).catch(({response:t})=>{Craft.cp.displayError(t.message||t.data.message)}).catch(t=>{console.error(t)}).then(()=>{o.focus()})},p=n=>{console.log("AIMate :: onGenerateAltTextClick"),n.preventDefault();const{currentTarget:a}=n;console.log(a.dataset);const{element:m,site:h}=a.dataset,u={elementId:m,siteId:h};console.log(u),a.classList.add("loading"),Craft.sendActionRequest("POST","_aimate/default/generate-alt-text",{data:{...u}}).then(s=>{window.location.reload()}).catch(({response:s})=>{Craft.cp.displayError(s.message||s.data.message)}).catch(s=>{console.error(s)}).then(()=>{a.classList.remove("loading")})};console.log("AIMate :: init"),$("body").on("click","[data-aimate-prompt-button]",r),$("body").on("click","[data-aimate-generate-alt-text-button]",p)});
//# sourceMappingURL=aimate.js.map
