const E=Garnish.Modal.extend({init:function(){this.base(),this.setSettings({resizable:!0});const o=$('<div class="modal fitted aimate-customprompt"></div>').addClass().appendTo(Garnish.$bod),r=$(`
                <div class="body" style="display:flex;flex-direction:column;min-height:100%;">
                    <div class="header" style="flex: none;">
                        <h1 style="margin-bottom:10px;">Custom prompt</h1>
                        <p class="notice has-icon">
                            <span class="icon" aria-hidden="true"></span>
                            <span>Add a &lt;text&gt; token to the prompt to include the current value in the field.</span>
                        </p>
                    </div>
                    <form method="post" accept-charset="UTF-8" style="display:flex;height:100%;flex: 1 1 auto;position:relative;">
                        <textarea style="width:420px;min-width:100%;max-width:100%;resize:none;padding:10px;"></textarea>
                    </form>
                </div>
            `).appendTo(o.empty()),c=$('<div class="footer"/>').appendTo(r),x=$('<div class="buttons right"/>').appendTo(c),i=$("<button/>",{type:"button",class:"btn",text:Craft.t("app","Cancel")}).appendTo(x),s=Craft.ui.createSubmitButton({label:Craft.t("app","Apply")}).appendTo(x);this.$textarea=r.find("textarea"),this.addListener(i,"click","onCancel"),this.addListener(s,"click","onApply"),this.$textarea=o.find("textarea"),this.setContainer(o)},onShow:function(){const o=this;this.promise=new Promise((r,c)=>{o.reject=c,o.resolve=r})},onHide:function(){this.$textarea.val("")},onCancel:function(){this.resolve(),this.hide()},onApply:function(){this.resolve(this.$textarea.val()),this.hide()},getText:function(){return this.promise}});$(()=>{let o;const r=async i=>{i.preventDefault();const{currentTarget:s}=i,y=s.closest("[data-aimate-menu]"),a=document.querySelector(`button[aria-controls="${y.id}"]`);if(a.classList.contains("loading"))return;$(a).trigger("click");const{field:g,element:l,site:m}=a.dataset,b=a.closest(".field");if(!b){Craft.cp.displayError("Field not found");return}const{type:d}=b.dataset;let t;if(d==="craft\\fields\\Table"?t=a.closest("td.textual").querySelector("input,textarea"):t=a.closest(".input").querySelector("input,textarea"),!t){Craft.cp.displayError("Input not found");return}let n={};if(s.hasAttribute("data-custom")){o||(o=new E),o.show();const e=await o.getText();if(!e)return;n.custom=e}else{const{prompt:e}=s.dataset;if(!e){Craft.cp.displayError("No prompt");return}n.prompt=e}const h=$(t.closest("[data-element-editor]")).data("elementEditor");n={...n,elementId:l,siteId:m},h&&(n={...n,draftId:h.settings.draftId,isProvisionalDraft:h.settings.isProvisionalDraft}),a.classList.add("loading"),Craft.sendActionRequest("POST","_aimate/default/do-prompt",{data:{text:t.value,...n}}).then(e=>{const{data:p}=e;if(!p.text)return;const v=t.closest(".field"),{type:C}=v.dataset;if(C==="craft\\ckeditor\\Field"){const u=v.querySelector(".ck-editor__editable"),f=u?u.ckeditorInstance:null;if(!f)throw new Error("Unable to find CKEditor instance in DOM");f.focus(),f.execute("selectAll");const T=f.data.processor.toView(p.text),w=f.data.toModel(T);f.model.insertContent(w)}else if(C==="craft\\redactor\\Field"){const u=$R(`#${t.id}`);u.editor.focus(),u.insertion.set(p.text),u.source.getElement().val(p.text)}else t.focus(),t.select(),document.execCommand("insertText",!1,p.text)||t.setRangeText(p.text);h&&h.checkForm()}).catch(({response:e})=>{Craft.cp.displayError(e.message||e.data.message)}).catch(e=>{console.error(e)}).then(()=>{a.classList.remove("loading"),t.focus()})},c=i=>{const s=i.get(0).closest(".field");if(!s)return;const y=s.querySelector("button[data-aimate]");if(!y)return;const a=i.children().get().filter(l=>l.classList.contains("singleline-cell","multiline-cell")),g=i.index();a.forEach(l=>{const m=$(y).clone(!1,!0),b=m.attr("aria-controls"),d=$($(`#${b}`)).clone(!1,!0),t=l.querySelector("textarea"),n=`${g}-${$(l).index()}`;d.attr("id",`${d.attr("id")}-${g}-${n}`),$("body").append(d),m.attr("aria-controls",d.attr("id")),$(t.parentNode).prepend(m.disclosureMenu())})};$(".field table.editable tbody tr").each(function(){c($(this))});const x=Craft.EditableTable.Row.prototype.init;Craft.EditableTable.Row.prototype.init=function(){x.apply(this,arguments),c(this.$tr)},$("body").on("click","[data-aimate-menu] a",r)});
//# sourceMappingURL=aimate.js.map
